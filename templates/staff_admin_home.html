{% extends "base.html" %}

{% block content %}
<h2>Admin Panel ({{ airline_name }})</h2>

<p>Welcome,
   {% if session.get('firstname') %}{{ session['firstname'] }}{% endif %}
   {% if session.get('lastname') %} {{ session['lastname'] }}{% endif %}
   — you are logged in as <strong>Admin</strong>.
</p>

<hr>

<h3>Add New Airport</h3>
<form method="post" action="{{ url_for('staff.admin_home') }}" class="air-filter-bar">
    <input type="hidden" name="form_type" value="airport">

    <div class="air-filter-item">
        <label>Airport Name:</label>
        <input type="text" name="airport_name" required>
    </div>

    <div class="air-filter-item">
        <label>City:</label>
        <input type="text" name="airport_city" required>
    </div>

    <button type="submit" class="air-btn-search">Add Airport</button>
</form>

<hr>

<h3>Add New Airplane (for {{ airline_name }})</h3>

<form method="post" action="{{ url_for('staff.admin_home') }}" class="air-filter-bar">
    <input type="hidden" name="form_type" value="airplane">

<!-- Airplane ID -->
<div class="air-filter-item">
    <label>Airplane ID:</label>
    <input type="text" name="airplane_id" required>
</div>

<!-- Seat Capacities -->
<div class="air-filter-item">
    <label>Economy Seats:</label>
    <input type="number" name="seat_capacity_economy" min="0" step="1" required>
</div>

<div class="air-filter-item">
    <label>Business Seats:</label>
    <input type="number" name="seat_capacity_business" min="0" step="1" required>
</div>

<div class="air-filter-item">
    <label>First Class Seats:</label>
    <input type="number" name="seat_capacity_first" min="0" step="1" required>
</div>

    <!-- Submit button -->
    <button type="submit" class="air-btn-search btn-small">Add Airplane</button>
</form>

<!-- Schema warning below the form -->
{# seat totals are derived from seat_class when no explicit column exists #}




<hr>

<h3>Associate Booking Agent with {{ airline_name }}</h3>
<form method="post" action="{{ url_for('staff.admin_home') }}" class="air-filter-bar">
    <input type="hidden" name="form_type" value="agent">

    <!-- Agent Email -->
    <div class="air-filter-item">
        <label>Agent Email:</label>
        <input type="email" name="agent_email" required>
    </div>

    <!-- Submit button -->
    <button type="submit" class="air-btn-search">Associate Agent</button>
</form>


{% if agents and agents|length > 0 %}
    <p>Currently associated agents:</p>
    <ul style="list-style: none; padding-left: 0;">
        {% for a in agents %}
        <li>{{ a.agent_email }}</li>
        {% endfor %}
    </ul>
{% endif %}

<hr>

<h3>Create New Flight</h3>
<form method="post" action="{{ url_for('staff.admin_home') }}" class="air-filter-bar">
    <input type="hidden" name="form_type" value="flight">

    <div style="display:flex; gap:30px; flex-wrap:wrap; width:100%;">
        <!-- 左边 -->
        <div style="flex:1; display:flex; flex-direction:column; gap:10px;">
            <div class="air-filter-item">
                <label>Flight #:</label>
                <input type="text" name="flight_num" required>
            </div>

            <div style="display:flex; gap:10px;">
                <div class="air-filter-item" style="flex:1;">
                    <label>Departure Airport:</label>
                    <select name="departure_airport" required>
                        {% for a in airports %}
                        <option value="{{ a.airport_name }}">{{ a.airport_name }} ({{ a.airport_city }})</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="air-filter-item" style="flex:1;">
                    <label>Arrival Airport:</label>
                    <select name="arrival_airport" required>
                        {% for a in airports %}
                        <option value="{{ a.airport_name }}">{{ a.airport_name }} ({{ a.airport_city }})</option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <div style="display:flex; gap:10px;">
                <div class="air-filter-item" style="flex:1;">
                    <label>Departure Time:</label>
                    <input type="datetime-local" name="departure_time" required>
                </div>

                <div class="air-filter-item" style="flex:1;">
                    <label>Arrival Time:</label>
                    <input type="datetime-local" name="arrival_time" required>
                </div>
            </div>
        </div>

        <!-- 右边 -->
        <div style="flex:1; display:flex; flex-direction:column; gap:10px;">
            <div class="air-filter-item">
                <label>Base Price:</label>
                <input type="number" name="base_price" min="0" step="1" required>
            </div>

            <div class="air-filter-item">
                <label>Airplane:</label>
                <select name="airplane_id_for_flight" required>
                    {% for p in airplanes %}
                    <option value="{{ p.airplane_id }}">
                        {{ p.airplane_id }}{% if seat_col_present %} ({{ p.seat_capacity }} seats){% endif %}
                    </option>
                    {% endfor %}
                </select>
            </div>

            <div class="air-filter-item">
                <label>Status:</label>
                <select name="status">
                    <option value="upcoming">upcoming</option>
                    <option value="on-time">on-time</option>
                    <option value="delayed">delayed</option>
                </select>
            </div>

            <button type="submit" class="air-btn-search" style="margin-top:10px; width:100%;">Create Flight</button>
        </div>
    </div>
</form>

<style>
/* 统一 input 和 select 宽度撑满父容器 */
.air-filter-item input,
.air-filter-item select {
    width: 100%;
    box-sizing: border-box;
}
</style>


<hr>

<h3>Existing Airplanes for {{ airline_name }}</h3>
{% if airplanes %}
<div style="max-width: 450px; margin: 0 auto;">  <!-- 限制宽度并居中 -->
    <table class="book-table" border="1" style="width: 100%;">
        <tr>
            <th>ID</th>
            <th>Total Seats{% if not seat_col_present %} (derived){% endif %}</th>
        </tr>
        {% for p in airplanes %}
        <tr>
            <td>{{ p.airplane_id }}</td>
            <td>{{ p.seat_capacity }}</td>
        </tr>
        {% endfor %}
    </table>
</div>
{% else %}
<p>No airplanes for this airline yet.</p>
{% endif %}


{% endblock %}
